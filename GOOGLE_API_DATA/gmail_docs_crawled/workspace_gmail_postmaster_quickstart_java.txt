Source URL: https://developers.google.com/workspace/gmail/postmaster/quickstart/java

이 페이지는 Cloud Translation API [https://cloud.google.com/translate/?hl=ko]를 통해 번역되었습니다.
Switch to English
홈 [https://developers.google.com/?hl=ko]
Google Workspace [https://developers.google.com/workspace?hl=ko]
Gmail [https://developers.google.com/workspace/gmail?hl=ko]
가이드 [https://developers.google.com/workspace/gmail/api/guides?hl=ko]
의견 보내기
자바 빠른 시작
bookmark_border
이 페이지의 내용
목표
기본 요건
환경 설정
API 사용 설정
OAuth 동의 화면 구성
데스크톱 애플리케이션의 사용자 인증 정보 승인
작업공간 준비
샘플 설정
Postmaster Tools API에 요청하는 Java 명령줄 애플리케이션을 만듭니다.
빠른 시작에서는 Google Workspace API를 호출하는 앱을 설정하고 실행하는 방법을 설명합니다. 이 빠른 시작에서는 테스트 환경에 적합한 간소화된 인증 방식을 사용합니다. 프로덕션 환경의 경우 앱에 적합한 액세스 사용자 인증 정보 선택 [https://developers.google.com/workspace/guides/create-credentials?hl=ko#choose_the_access_credential_that_is_right_for_you] 전에 인증 및 승인 [https://developers.google.com/workspace/guides/auth-overview?hl=ko]에 대해 알아보는 것이 좋습니다.
이 빠른 시작에서는 Google Workspace의 권장 API 클라이언트 라이브러리를 사용하여 인증 및 승인 흐름의 일부 세부정보를 처리합니다.
목표
환경을 설정합니다.
샘플을 설정합니다.
샘플을 실행합니다.
기본 요건
Java 11 이상
Gradle 7.0 이상 [https://gradle.org/install/]
Google Cloud 프로젝트 [https://developers.google.com/workspace/guides/create-project?hl=ko].
Gmail이 사용 설정된 Google 계정
환경 설정
이 빠른 시작을 완료하려면 환경을 설정하세요.
API 사용 설정
Google API를 사용하려면 먼저 Google Cloud 프로젝트에서 사용 설정해야 합니다. 단일 Google Cloud 프로젝트에서 하나 이상의 API를 사용 설정할 수 있습니다.
Google Cloud 콘솔에서 Postmaster Tools API를 사용 설정합니다.
API 사용 설정 [https://console.cloud.google.com/flows/enableapi?apiid=gmailpostmastertools.googleapis.com&hl=ko]
OAuth 동의 화면 구성
새 Google Cloud 프로젝트를 사용하여 이 빠른 시작을 완료하는 경우 OAuth 동의 화면을 구성합니다. Cloud 프로젝트에서 이 단계를 이미 완료했다면 다음 섹션으로 건너뜁니다.
Google Cloud 콘솔에서 메뉴 menu > > 브랜딩으로 이동합니다.
브랜딩으로 이동 [https://console.cloud.google.com/auth/branding?hl=ko]
을 이미 구성한 경우 브랜딩 [https://console.cloud.google.com/auth/branding?hl=ko], 잠재고객 [https://console.cloud.google.com/auth/audience?hl=ko], 데이터 액세스 [https://console.cloud.google.com/auth/scopes?hl=ko]에서 다음 OAuth 동의 화면 설정을 구성할 수 있습니다. 아직 구성되지 않음이라는 메시지가 표시되면 시작하기를 클릭합니다.
앱 정보의 앱 이름에 앱 이름을 입력합니다.
사용자 지원 이메일에서 사용자가 동의에 대해 문의할 수 있는 지원 이메일 주소를 선택합니다.
다음을 클릭합니다.
시청자층에서 내부를 선택합니다.
다음을 클릭합니다.
연락처 정보에서 프로젝트 변경사항에 대한 알림을 받을 수 있는 이메일 주소를 입력합니다.
다음을 클릭합니다.
완료에서 Google API 서비스 사용자 데이터 정책 [https://developers.google.com/terms/api-services-user-data-policy?hl=ko]을 검토하고 동의하는 경우 Google API 서비스: 사용자 데이터 정책에 동의합니다를 선택합니다.
계속을 클릭합니다.
만들기를 클릭합니다.
지금은 범위를 추가하지 않아도 됩니다. 향후 Google Workspace 조직 외부에서 사용할 앱을 만들 때는 사용자 유형을 외부로 변경해야 합니다. 그런 다음 앱에 필요한 승인 범위를 추가합니다. 자세한 내용은 OAuth 동의 구성 [https://developers.google.com/workspace/guides/configure-oauth-consent?hl=ko] 가이드를 참고하세요.
데스크톱 애플리케이션의 사용자 인증 정보 승인
최종 사용자를 인증하고 앱에서 사용자 데이터에 액세스하려면 OAuth 2.0 클라이언트 ID를 하나 이상 만들어야 합니다. 클라이언트 ID는 Google OAuth 서버에서 단일 앱을 식별하는 데 사용됩니다. 앱이 여러 플랫폼에서 실행되는 경우 플랫폼별로 별도의 클라이언트 ID를 만들어야 합니다.
Google Cloud 콘솔에서 메뉴 menu > > 클라이언트로 이동합니다.
클라이언트로 이동 [https://console.cloud.google.com/auth/clients?hl=ko]
클라이언트 만들기를 클릭합니다.
애플리케이션 유형 > 데스크톱 앱을 클릭합니다.
이름 필드에 사용자 인증 정보의 이름을 입력합니다. 이 이름은 Google Cloud 콘솔에만 표시됩니다.
만들기를 클릭합니다.
새로 만든 사용자 인증 정보가 'OAuth 2.0 클라이언트 ID' 아래에 표시됩니다.
다운로드한 JSON 파일을 credentials.json로 저장하고 파일을 작업 디렉터리로 이동합니다.
작업공간 준비
작업 디렉터리에서 새 프로젝트 구조를 만듭니다.
gradle init --type basic
mkdir -p src/main/java src/main/resources 
src/main/resources/ 디렉터리에서 이전에 다운로드한 credentials.json 파일을 복사합니다.
기본 build.gradle 파일을 열고 콘텐츠를 다음 코드로 바꿉니다.
  apply plugin: 'java'
apply plugin: 'application'

mainClassName = 'GmailPostmasterToolsQuickstart'
sourceCompatibility = 1.8
targetCompatibility = 1.8
version = '1.0'

repositories {
    mavenCentral()
}

dependencies {
    implementation 'com.google.api-client:google-api-client:1.23.0'
    implementation 'com.google.oauth-client:google-oauth-client-jetty:1.23.0'
    implementation 'com.google.apis:google-api-services-gmailpostmastertools:v1-rev20210528-1.31.0'
}
샘플 설정
src/main/java/ 디렉터리에서 build.gradle 파일의 mainClassName 값과 일치하는 이름의 새 Java 파일을 만듭니다.
새 Java 파일에 다음 코드를 포함합니다.
import com.google.api.client.auth.oauth2.Credential;
import com.google.api.client.extensions.java6.auth.oauth2.AuthorizationCodeInstalledApp;
import com.google.api.client.extensions.jetty.auth.oauth2.LocalServerReceiver;
import com.google.api.client.googleapis.auth.oauth2.GoogleAuthorizationCodeFlow;
import com.google.api.client.googleapis.auth.oauth2.GoogleClientSecrets;
import com.google.api.client.googleapis.javanet.GoogleNetHttpTransport;
import com.google.api.client.http.javanet.NetHttpTransport;
import com.google.api.client.json.JsonFactory;
import com.google.api.client.json.jackson2.JacksonFactory;
import com.google.api.client.util.store.FileDataStoreFactory;
import com.google.api.services.gmailpostmastertools.v1beta1.PostmasterTools;
import com.google.api.services.gmailpostmastertools.v1beta1.model.*;

import java.io.*;
import java.security.GeneralSecurityException;
import java.util.Collections;
import java.util.List;

public class PostmasterToolsApiQuickStart {
    private static final String APPLICATION_NAME = "PostmasterTools API Java Quickstart";
    private static final JsonFactory JSON_FACTORY = JacksonFactory.getDefaultInstance();
    private static final String TOKENS_DIRECTORY_PATH = "tokens";

    /**
     * Global instance of the scopes required by this quickstart.
     * If modifying these scopes, delete your previously saved tokens/ folder.
     */
    private static final List<String> SCOPES = Collections.singletonList("https://www.googleapis.com/auth/postmaster.readonly");
    private static final String CREDENTIALS_FILE_PATH = "/credentials.json";

    /**
     * Creates an authorized Credential object.
     * @param HTTP_TRANSPORT The network HTTP Transport.
     * @return An authorized Credential object.
     * @throws IOException If the credentials.json file cannot be found.
     */
    private static Credential getCredentials(final NetHttpTransport HTTP_TRANSPORT) throws IOException {
        // Load client secrets.
        InputStream in = PostmasterToolsApiQuickStart.class.getResourceAsStream(CREDENTIALS_FILE_PATH);
        if (in == null) {
            throw new FileNotFoundException("Resource not found: " + CREDENTIALS_FILE_PATH);
        }
        GoogleClientSecrets clientSecrets = GoogleClientSecrets.load(JSON_FACTORY, new InputStreamReader(in));

        // Build flow and trigger user authorization request.
        GoogleAuthorizationCodeFlow flow = new GoogleAuthorizationCodeFlow.Builder(
                HTTP_TRANSPORT, JSON_FACTORY, clientSecrets, SCOPES)
                .setDataStoreFactory(new FileDataStoreFactory(new java.io.File(TOKENS_DIRECTORY_PATH)))
                .setAccessType("offline")
                .build();
        LocalServerReceiver receiver = new LocalServerReceiver.Builder().setPort(8891).build();
        return new AuthorizationCodeInstalledApp(flow, receiver).authorize("user");
    }

    public static void main(String... args) throws IOException, GeneralSecurityException {
        // Build a new authorized API client service.
        final NetHttpTransport HTTP_TRANSPORT = GoogleNetHttpTransport.newTrustedTransport();
        PostmasterTools postmasterTools = new PostmasterTools.Builder(HTTP_TRANSPORT, JSON_FACTORY, getCredentials(HTTP_TRANSPORT))
                .setApplicationName(APPLICATION_NAME)
                .build();

        List<Domain> domains = postmasterTools.domains().list().execute().getDomains();
        if (domains == null || domains.isEmpty()) {
            System.out.println("No domains found!");
        } else {
            for (Domain domain : domains) {
                System.out.println(domain.toPrettyString());
            }
        }
    }
}
샘플 실행
샘플을 실행합니다.
gradle run
샘플을 처음 실행하면 액세스 권한을 승인하라는 메시지가 표시됩니다.
아직 Google 계정에 로그인하지 않았다면 메시지가 표시될 때 로그인합니다. 여러 계정에 로그인되어 있는 경우 승인에 사용할 계정을 하나 선택합니다.
수락을 클릭합니다.
Java 애플리케이션이 실행되고 Postmaster Tools API를 호출합니다.
승인 정보는 파일 시스템에 저장되므로 다음에 샘플 코드를 실행할 때는 승인 메시지가 표시되지 않습니다.
다음 단계
인증 및 승인 문제 해결 [https://developers.google.com/drive/activity/v2/troubleshoot-authentication-authorization?hl=ko]
Postmaster Tools API REST 참조 문서 [https://developers.google.com/workspace/gmail/postmaster/reference/rest?hl=ko]
Java용 Google API 클라이언트 문서 [https://developers.google.com/api-client-library/java?hl=ko]
Postmaster Tools API Javadoc 문서 [https://googleapis.dev/java/google-api-services-gmailpostmastertools/latest/index.html]
의견 보내기